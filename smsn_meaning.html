<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ëœ» ë§ì¶”ê¸° í€´ì¦ˆ - ë°˜ë³µ í•™ìŠµ ë²„ì „</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
      background-color: #f0f8ff;
    }
    .question {
      font-size: 28px;
      margin-bottom: 20px;
      cursor: pointer;
      color: darkblue;
    }
    .options {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin: 20px auto;
      max-width: 400px;
    }
    button.option {
      padding: 12px;
      font-size: 18px;
      width: 100%;
      cursor: pointer;
    }
    .feedback {
      font-size: 20px;
      margin-top: 15px;
      font-weight: bold;
    }
    #nextBtn, #restartBtn {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      display: none;
    }
    #resultPage {
      display: none;
    }
  </style>
</head>
<body>

<h1>ëœ» ë§ì¶”ê¸° í€´ì¦ˆ</h1>

<div id="quizPage">
  <div class="question" id="word" onclick="playAudio()">ë‹¨ì–´</div>
  <div class="options">
    <button class="option" onclick="checkAnswer(this)"></button>
    <button class="option" onclick="checkAnswer(this)"></button>
    <button class="option" onclick="checkAnswer(this)"></button>
  </div>
  <div class="feedback" id="feedback"></div>
  <button id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
</div>

<div id="resultPage">
  <h2>í€´ì¦ˆ ì™„ë£Œ!</h2>
  <p id="scoreSummary"></p>
  <button id="restartBtn" onclick="startNextPhase()">ì¬ë„ì „</button>
</div>

<script>
const allWords = [
  { word: "smash", meaning: "ë•Œë ¤ ë¶€ìˆ˜ë‹¤" },
  { word: "smack", meaning: "ì°°ì‹¹ ë•Œë¦¬ë‹¤" },
  { word: "smart", meaning: "ë˜‘ë˜‘í•œ" },
  { word: "smell", meaning: "ëƒ„ìƒˆë‚˜ë‹¤" },
  { word: "smile", meaning: "ë¯¸ì†Œ ì§“ë‹¤" },
  { word: "smite", meaning: "ì„¸ê²Œ ì¹˜ë‹¤" },
  { word: "smoke", meaning: "ì—°ê¸°" },
  { word: "smuggle", meaning: "ë°€ìˆ˜í•˜ë‹¤" },
  { word: "snack", meaning: "ê°„ì‹" },
  { word: "snap", meaning: "ë”± ë¶€ëŸ¬ì§€ë‹¤" },
  { word: "sneeze", meaning: "ì¬ì±„ê¸°í•˜ë‹¤" },
  { word: "sniff", meaning: "í‚í‚ê±°ë¦¬ë‹¤" },
  { word: "snip", meaning: "ì‹¹ë‘‘ ìë¥´ë‹¤" },
  { word: "snore", meaning: "ì½”ë¥¼ ê³¨ë‹¤" },
  { word: "snort", meaning: "ì½§ê¹€ì„ ë‚´ë¿œë‹¤" }
];

let wordPool = [];
let history = [];
let phase = 1;
let score = 0;
let questionCount = 0;
let currentWord = "";
let currentAnswer = "";
let tries = 0;
let hasAnsweredCorrectly = false;

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function playAudio() {
  const utter = new SpeechSynthesisUtterance(currentWord);
  utter.lang = "en-US";
  utter.rate = 0.75;
  speechSynthesis.speak(utter);
}

function startQuiz(initial = false) {
  document.getElementById("quizPage").style.display = "block";
  document.getElementById("resultPage").style.display = "none";
  score = 0;
  questionCount = 0;
  history = [];
  if (initial) {
    shuffle(allWords);
    wordPool = allWords.slice(0, 10);
    phase = 1;
  }
  nextQuestion();
}

function nextQuestion() {
  document.getElementById("feedback").innerText = "";
  document.getElementById("nextBtn").style.display = "none";
  hasAnsweredCorrectly = false;
  tries = 0;

  if (wordPool.length === 0) {
    showResults();
    return;
  }

  const idx = Math.floor(Math.random() * wordPool.length);
  const wordObj = wordPool.splice(idx, 1)[0];
  currentWord = wordObj.word;
  currentAnswer = wordObj.meaning;
  document.getElementById("word").innerText = currentWord;

  const wrongs = allWords.filter(w => w.meaning !== currentAnswer);
  shuffle(wrongs);
  const choices = [currentAnswer, wrongs[0].meaning, wrongs[1].meaning];
  shuffle(choices);

  document.querySelectorAll(".option").forEach((btn, i) => {
    btn.innerText = choices[i];
    btn.disabled = false;
  });
}

function checkAnswer(btn) {
  if (hasAnsweredCorrectly) return;

  tries++;
  const selected = btn.innerText;
  if (selected === currentAnswer) {
    hasAnsweredCorrectly = true;
    score++;
    document.getElementById("feedback").innerText = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
    document.getElementById("feedback").style.color = "green";
    document.getElementById("nextBtn").style.display = "inline-block";

    document.querySelectorAll(".option").forEach(b => b.disabled = true);
    history.push({ word: currentWord, tries: tries });
  } else {
    btn.disabled = true;
    document.getElementById("feedback").innerText = "âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.";
    document.getElementById("feedback").style.color = "red";
  }
}

function showResults() {
  document.getElementById("quizPage").style.display = "none";
  document.getElementById("resultPage").style.display = "block";

  if (phase < 3) {
    const retryWords = history.filter(h => h.tries === 2 || h.tries === 3).map(h => h.word);
    wordPool = retryWords.map(w => allWords.find(obj => obj.word === w));
    document.getElementById("scoreSummary").innerText =
      `ì´ ì ìˆ˜: ${score} / ${history.length} (2~3ë²ˆ ì‹œë„í•œ ë‹¨ì–´ ${wordPool.length}ê°œ ë‹¤ì‹œ í’€ê¸°)`;
    document.getElementById("restartBtn").style.display = wordPool.length ? "inline-block" : "none";
  } else {
    const needsRetry = history.filter(h => h.tries > 1);
    if (needsRetry.length === 0) {
      document.getElementById("scoreSummary").innerText = "ğŸ‰ ëª¨ë“  ë‹¨ì–´ë¥¼ ì²« ì‹œë„ì— ë§ì·„ì–´ìš”! í•™ìŠµ ì™„ë£Œ!";
      document.getElementById("restartBtn").style.display = "none";
    } else {
      wordPool = needsRetry.map(h => allWords.find(obj => obj.word === h.word));
      document.getElementById("scoreSummary").innerText =
        `âš ï¸ ì•„ì§ ${wordPool.length}ê°œì˜ ë‹¨ì–´ì—ì„œ ì²« ì‹œë„ ì˜¤ë‹µì´ ìˆì—ˆì–´ìš”. ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!`;
      document.getElementById("restartBtn").style.display = "inline-block";
    }
  }
}

function startNextPhase() {
  phase++;
  history = [];
  score = 0;
  questionCount = 0;
  startQuiz(false);
}

startQuiz(true);
</script>

</body>
</html>
